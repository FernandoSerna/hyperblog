VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Begin VB.Form frmlistatitulares 
   BorderStyle     =   1  'Fixed Single
   Caption         =   "Lista de titulares"
   ClientHeight    =   3885
   ClientLeft      =   45
   ClientTop       =   330
   ClientWidth     =   5940
   Icon            =   "frmlistatitulares.frx":0000
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MDIChild        =   -1  'True
   MinButton       =   0   'False
   ScaleHeight     =   3885
   ScaleWidth      =   5940
   Begin VB.Frame frm_lista 
      Height          =   2400
      Left            =   105
      TabIndex        =   2
      Top             =   750
      Width           =   5685
      Begin MSComctlLib.ListView lv_lista 
         Height          =   1830
         Left            =   15
         TabIndex        =   3
         Top             =   495
         Width           =   5595
         _ExtentX        =   9869
         _ExtentY        =   3228
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   3
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Clave"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Nombre"
            Object.Width           =   7937
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Text            =   "Titular"
            Object.Width           =   0
         EndProperty
      End
      Begin VB.Label lbl_lista 
         BackColor       =   &H8000000D&
         ForeColor       =   &H8000000E&
         Height          =   255
         Left            =   30
         TabIndex        =   4
         Top             =   120
         Width           =   5610
      End
   End
   Begin VB.Frame Frame3 
      Height          =   3765
      Left            =   75
      TabIndex        =   0
      Top             =   -15
      Width           =   5820
      Begin MSComctlLib.ListView lv_listatitulares 
         Height          =   3600
         Left            =   45
         TabIndex        =   1
         ToolTipText     =   "Catálogo de titulares F5"
         Top             =   120
         Width           =   5715
         _ExtentX        =   10081
         _ExtentY        =   6350
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   16
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Clave"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Nombre"
            Object.Width           =   10583
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Text            =   "representante"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   3
            Text            =   "fecha"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   4
            Text            =   "vendedor"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   5
            Text            =   "ruta"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   6
            Text            =   "curp"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   7
            Text            =   "rfc"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   8
            Text            =   "moneda"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   9
            Text            =   "plazo"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   10
            Text            =   "tipo"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(12) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   11
            Text            =   "lista"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(13) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   12
            Text            =   "canal"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(14) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   13
            Text            =   "descripcion"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(15) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   14
            Text            =   "transporte"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(16) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   15
            Text            =   "estatus"
            Object.Width           =   0
         EndProperty
      End
   End
End
Attribute VB_Name = "frmlistatitulares"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

Private Sub Form_Load()
   frm_lista.Visible = False
   var_cadena_seguridad = ""
   Top = 2000
   Left = 2900
   Dim numero_items_titulares As Integer
   If UCase(parametros(0)) = "DISTRIBUCION" Then
   rs.Open "select distinct vcha_tit_titular_id, vcha_tit_nombre  from tb_titulares where vcha_tit_nombre <> ''  and vcha_emp_empresa_id = '" + var_empresa + "' order by vcha_tit_nombre", cnn_distribucion, adOpenDynamic, adLockBatchOptimistic
   Else
      If var_empresa = "31" And (parametros(0) = "sqlquezada2" Or parametros(o) = "DBPRUEBAS") Then
         rs.Open "select distinct vcha_tit_titular_id, vcha_tit_nombre  from tb_titulares where vcha_tit_titular_id = 'T000008778' " ' order by vcha_tit_nombre", cnn_distribucion, adOpenDynamic, adLockBatchOptimistic
      Else
         rs.Open "select distinct vcha_tit_titular_id, vcha_tit_nombre  from tb_titulares where vcha_tit_nombre <> ''  and vcha_emp_empresa_id = '" + var_empresa + "' order by vcha_tit_nombre", cnn_distribucion, adOpenDynamic, adLockBatchOptimistic
      End If
   End If
   numero_items_titulares = 0
   While Not rs.EOF
      Set list_item = lv_listatitulares.ListItems.Add(, , rs!vcha_tit_titular_id)
      list_item.SubItems(1) = IIf(IsNull(rs!VCHA_TIT_NOMBRE), "", rs!VCHA_TIT_NOMBRE)
      rs.MoveNext:
      numero_items_titulares = numero_items_titulares + 1
   Wend
   rs.Close
   If numero_items_titulares > 13 Then
      lv_listatitulares.ColumnHeaders(2).Width = 5410
   Else
      lv_listatitulares.ColumnHeaders(2).Width = 6060
   End If
End Sub

Private Sub Form_Unload(Cancel As Integer)
   Frmmenu2.StatusBar1.Panels(1) = ""
   var_swpassword = False
   var_modifica_registro = False
   vartipotitular = 0
   Call activa_forma(var_activa_forma_listatitulares)
End Sub

Private Sub lv_lista_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
   Call pro_ordena_listas(lv_lista, ColumnHeader)
End Sub

Private Sub lv_lista_KeyPress(KeyAscii As Integer)
   If KeyAscii = 13 Then
      rs.Open "select * from tb_titulares where vcha_tit_titular_id = '" + Me.lv_lista.selectedItem.SubItems(2) + "' and vcha_emp_empresa_id = '" + var_empresa + "'", cnn_distribucion, adOpenDynamic, adLockOptimistic
      If Not rs.EOF Then
         Set itmfound = Me.lv_listatitulares.findItem(Me.lv_lista.selectedItem.SubItems(2), lvwText, , lvwPartial)
         itmfound.EnsureVisible
         itmfound.Selected = True
         frm_lista.Visible = False
      Else
         MsgBox "No se encuentra el titular", vbOKOnly, "ATENCION"
         frm_lista.Visible = False
      End If
      rs.Close
   End If
   If KeyAscii = 27 Then
      frm_lista.Visible = False
   End If
End Sub

Private Sub lv_lista_LostFocus()
   frm_lista.Visible = False
End Sub

Private Sub lv_listatitulares_DblClick()
   If vartipotitular = 1 Then
      var_cliente_pedido_internet = ""
      var_tipo_filtrado_cliente = 1
      frmclientes.Caption = "Clientes del titular:  [" + Trim(lv_listatitulares.selectedItem) + "] " + lv_listatitulares.selectedItem.SubItems(1)
      frmclientes.Show
      var_activa_forma_clientes = Me.Name
   End If
   If vartipotitular = 2 Then
       var_cliente_pedido_internet = ""
     frmestablecimientos.Caption = "Establecimientos del titular:  [" + Trim(lv_listatitulares.selectedItem) + "] " + lv_listatitulares.selectedItem.SubItems(1)
      frmestablecimientos.Show
      var_activa_forma_establecimientos = Me.Name
   End If
End Sub

Private Sub lv_listatitulares_GotFocus()
   If vartipotitular = 1 Then
      var_cliente_pedido_internet = ""
      Frmmenu2.StatusBar1.Panels(1) = "Presione F5 para ver la información disponible de clientes y F6 para accesar al catálogo"
   End If
   If vartipotitular = 2 Then
      var_cliente_pedido_internet = ""
      Frmmenu2.StatusBar1.Panels(1) = "Presione F5 para ver la información disponible de establecimientos y F6 para accesar al catálogo"
   End If
End Sub

Private Sub lv_listatitulares_KeyDown(KeyCode As Integer, Shift As Integer)
   If KeyCode = 117 Then
      var_cliente_pedido_internet = ""
      frmtitulares.Show
      lv_listatitulares.ListItems.Clear
      rs.Open "select * from tb_TITULARES  where vcha_emp_empresa_id = '" + var_empresa + "' order by vcha_tit_nombre", cnn_distribucion, adOpenDynamic, adLockBatchOptimistic
      While Not rs.EOF
         Set list_item = lv_listatitulares.ListItems.Add(, , rs(1).Value)
         list_item.SubItems(1) = IIf(IsNull(rs(2).Value), "", rs(2).Value)
         rs.MoveNext:
      Wend
      rs.Close
   End If
   If KeyCode = 116 Then
      If vartipotitular = 1 Then
         If KeyCode = 116 Then
            lv_lista.ListItems.Clear
            rs.Open "select * from tb_clientes where vcha_emp_empresa_id = '" + var_empresa + "' order by vcha_cli_nombre", cnn_distribucion, adOpenDynamic, adLockOptimistic
            While Not rs.EOF
                  Set list_item = lv_lista.ListItems.Add(, , rs!vcha_cli_clave_id)
                  list_item.SubItems(1) = IIf(IsNull(rs!VCHA_CLI_NOMBRE), "", rs!VCHA_CLI_NOMBRE)
                  list_item.SubItems(2) = IIf(IsNull(rs!vcha_tit_titular_id), "", rs!vcha_tit_titular_id)
                  rs.MoveNext
            Wend
            rs.Close
            lbl_lista = "Clientes"
            var_tipo_lista = 1
            var_n = lv_lista.ListItems.Count
            If var_n > 6 Then
               lv_lista.ColumnHeaders(2).Width = 3770
            Else
               lv_lista.ColumnHeaders(2).Width = 3999
            End If
            frm_lista.Visible = True
            lv_lista.SetFocus
         End If
      End If
      If vartipotitular = 2 Then
         If KeyCode = 116 Then
            lv_lista.ListItems.Clear
            rs.Open "select * from tb_establecimientos where vcha_emp_empresa_id = '" + var_empresa + "' order by vcha_esb_nombre", cnn_distribucion, adOpenDynamic, adLockOptimistic
            While Not rs.EOF
                  Set list_item = lv_lista.ListItems.Add(, , rs!vcha_ESB_ESTABLECIMIENTO_id)
                  list_item.SubItems(1) = IIf(IsNull(rs!VCHA_ESB_NOMBRE), "", rs!VCHA_ESB_NOMBRE)
                  list_item.SubItems(2) = IIf(IsNull(rs!vcha_tit_titular_id), "", rs!vcha_tit_titular_id)
                  rs.MoveNext
            Wend
            rs.Close
            lbl_lista = "Establecimientos"
            var_tipo_lista = 1
            var_n = lv_lista.ListItems.Count
            If var_n > 6 Then
               lv_lista.ColumnHeaders(2).Width = 3770
            Else
               lv_lista.ColumnHeaders(2).Width = 3999
            End If
            frm_lista.Visible = True
            lv_lista.SetFocus
         End If
      End If
   End If
End Sub

Private Sub lv_listatitulares_KeyPress(KeyAscii As Integer)
   If KeyAscii = 13 Then
      var_cliente_pedido_internet = ""
      If vartipotitular = 1 Then
         var_tipo_filtrado_cliente = 1
         frmclientes.Caption = "Clientes del titular:  [" + Trim(lv_listatitulares.selectedItem) + "] " + lv_listatitulares.selectedItem.SubItems(1)
         frmclientes.Show
      End If
      If vartipotitular = 2 Then
         frmestablecimientos.Caption = "Establecimientos del titular:  [" + Trim(lv_listatitulares.selectedItem) + "] " + lv_listatitulares.selectedItem.SubItems(1)
         frmestablecimientos.Show
      End If
   End If
   If KeyAscii = 27 Then
      var_cliente_pedido_internet = ""
      Unload Me
   End If
End Sub
